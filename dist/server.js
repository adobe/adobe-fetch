module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){const r=n(1),o=n(3);global.fetch=n(4);const i=n(5);e.exports={config:i.getConfig(r,o),normalizeHeaders:i.normalizeHeaders,generateRequestID:i.generateRequestID,AUTH_MODES:i.AUTH_MODES}},function(e,t,n){const r=n(2);let o=null,i=!1;e.exports.read=async function(){return i||await async function(){return o||(o=r.init().then(()=>i=!0)),o}(),await r.getItem("tokens")},e.exports.write=async function(e){return await r.setItem("tokens",e)}},function(e,t){e.exports=require("node-persist")},function(e,t){e.exports=require("@adobe/jwt-auth")},function(e,t){e.exports=require("node-fetch")},function(e,t,n){const r=n(6),o=n(7),i=n(8)("@adobe/fetch"),a={JWT:"jwt",Provided:"provided"};function s(){return o().replace(/-/g,"")}function u(e){let t={};if(e)if("function"==typeof e.entries)for(let n of e.entries()){const[e,r]=n;t[e.toLowerCase()]=r}else for(let n in e)t[n.toLowerCase()]=e[n];return t}async function c(e,t,n,r,o,s){const d=await async function(e,t,n,r){const o=e.auth_key;let i=await t.get(o);if(i&&!n)return i;{let n=void 0;n=e.mode===a.JWT?async()=>await r(e):async()=>await e.tokenProvider();try{if(i=await n(),i)return t.set(o,i);throw"Access token empty"}catch(e){throw console.error("Error while getting a new access token.",e),e}}}(n.auth,r,o,s),f=Object.assign({},t);f.headers=function(e,t,n){let r=function(e){let t={};for(let n in e){const r=e[n];t[n]="function"==typeof r?r():r}return t}(n);var o;return t&&t.headers&&(r=Object.assign(r,u(t.headers))),r.authorization=`${o=e.token_type,o[0].toUpperCase()+o.slice(1)} ${e.access_token}`,r}(d,t,n.headers),i(`${f.method||"GET"} ${e} - x-request-id: ${f.headers["x-request-id"]}`);const l=await fetch(e,f);return l.ok||(i(`${f.method||"GET"} ${e} - status ${l.statusText} (${l.status}). x-request-id: ${f.headers["x-request-id"]}`),401!==l.status&&403!==l.status||o)?l:(i(`${t.method||"GET"} ${e} - Will get new token.`),await c(e,t,n,r,!0,s))}function d(e,t){if(!e.auth)throw"Auth configuration missing.";e.auth.mode||(e.auth.mode=t?a.JWT:a.Provided),function(e,t){let{mode:n,clientId:r,technicalAccountId:o,orgId:i,clientSecret:s,privateKey:u,metaScopes:c,storage:d,tokenProvider:f}=e;const l=[];if(n===a.JWT){if(!r&&l.push("clientId"),!o&&l.push("technicalAccountId"),!i&&l.push("orgId"),!s&&l.push("clientSecret"),!u&&l.push("privateKey"),(!c||0===c.length)&&l.push("metaScopes"),!t)throw"JWT authentication is not available in current setup.";if(u&&!("string"==typeof u||u instanceof Buffer||ArrayBuffer.isView(u)))throw"Required parameter privateKey is invalid";l.length||(e.auth_key=`${r}|${c.join(",")}`)}else{if(n!==a.Provided)throw`Invalid authentication mode - ${e.mode}`;if(!r&&l.push("clientId"),!i&&l.push("orgId"),!f&&l.push("tokenProvider"),l.length||(e.auth_key=`${r}|org-${i}`),f&&"function"!=typeof f)throw"Required parameter tokenProvider needs to be a function"}if(l.length>0)throw`Required parameter(s) ${l.join(", ")} are missing`;if(d){let{read:e,write:t}=d;if(!e)throw"Storage read method missing!";if(!t)throw"Storage write method missing!"}}(e.auth,t),e.headers=Object.assign({"x-api-key":e.auth.clientId,"x-request-id":()=>s(),"x-gw-ims-org-id":e.auth.orgId},u(e.headers))}e.exports={getConfig:function(e,t){return n=>{d(n,!!t);const o=r.config(n.auth,e);return(e,r={})=>function(e,t,n,r,o){return c(e,t,n,r,!1,o)}(e,r,n,o,t)}},normalizeHeaders:u,generateRequestID:s,AUTH_MODES:a}},function(e,t){async function n(e){e.disableStorage||(e.tokens=await e.read()||{},e.readOnce=!0)}function r(e,t){return void 0!==t.tokens&&t.tokens[e]&&t.tokens[e].expires_at>Date.now()?t.tokens[e]:void 0}e.exports.config=function(e,t){const o=e&&e.disableStorage||!1,i={disableStorage:o,readOnce:o,read:e.storage?e.storage.read:t.read,write:e.storage?e.storage.write:t.write,tokens:{}};return{set:(e,t)=>async function(e,t,r){return t.expires_at=Date.now()+t.expires_in-6e4,await n(r),r.tokens[e]=t,await async function(e){e.disableStorage||await e.write(e.tokens)}(r),t}(e,t,i),get:e=>async function(e,t){let o=!1;t.readOnce||(await n(t),o=!0);let i=r(e,t);return i||o?i:(await n(t),r(e,t))}(e,i)}}},function(e,t){e.exports=require("uuid/v4")},function(e,t){e.exports=require("debug")}]);