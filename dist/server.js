module.exports["@adobe/fetch"]=(()=>{var e={10:(e,t,r)=>{const n=r(75),o=r(819);global.fetch=r(786);const i=r(667);e.exports={config:i.getConfig(n,o),normalizeHeaders:i.normalizeHeaders,generateRequestID:i.generateRequestID,AUTH_MODES:i.AUTH_MODES}},667:(e,t,r)=>{const n=r(265),{v4:o}=r(231),i=r(682)("@adobe/fetch"),a={JWT:"jwt",Provided:"provided"};function s(){return o().replace(/-/g,"")}function u(e){let t={};if(e)if("function"==typeof e.entries)for(let r of e.entries()){const[e,n]=r;t[e.toLowerCase()]=n}else for(let r in e)t[r.toLowerCase()]=e[r];return t}async function c(e,t,r,n,o,s){const d=await async function(e,t,r,n){const o=e.auth_key;let i=await t.get(o);if(i&&!r)return i;{let r;r=e.mode===a.JWT?async()=>await n(e):async()=>await e.tokenProvider();try{if(i=await r(),i)return t.set(o,i);throw"Access token empty"}catch(e){throw console.error("Error while getting a new access token.",e),e}}}(r.auth,n,o,s),f=Object.assign({},t);f.headers=function(e,t,r){let n=function(e){let t={};for(let r in e){const n=e[r];t[r]="function"==typeof n?n():n}return t}(r);var o;return t&&t.headers&&(n=Object.assign(n,u(t.headers))),n.authorization=`${o=e.token_type,o[0].toUpperCase()+o.slice(1)} ${e.access_token}`,n}(d,t,r.headers),i(`${f.method||"GET"} ${e} - x-request-id: ${f.headers["x-request-id"]}`);const h=await fetch(e,f);return h.ok||(i(`${f.method||"GET"} ${e} - status ${h.statusText} (${h.status}). x-request-id: ${f.headers["x-request-id"]}`),401!==h.status&&403!==h.status||o)?h:(i(`${t.method||"GET"} ${e} - Will get new token.`),await c(e,t,r,n,!0,s))}e.exports={getConfig:function(e,t){return r=>{!function(e,t){if(!e.auth)throw"Auth configuration missing.";e.auth.mode||(e.auth.mode=t?a.JWT:a.Provided),function(e,t){let{mode:r,clientId:n,technicalAccountId:o,orgId:i,clientSecret:s,privateKey:u,metaScopes:c,storage:d,tokenProvider:f}=e;const h=[];if(r===a.JWT){if(!n&&h.push("clientId"),!o&&h.push("technicalAccountId"),!i&&h.push("orgId"),!s&&h.push("clientSecret"),!u&&h.push("privateKey"),(!c||0===c.length)&&h.push("metaScopes"),!t)throw"JWT authentication is not available in current setup.";if(u&&!("string"==typeof u||u instanceof Buffer||ArrayBuffer.isView(u)))throw"Required parameter privateKey is invalid";h.length||(e.auth_key=`${n}|${c.join(",")}`)}else{if(r!==a.Provided)throw`Invalid authentication mode - ${e.mode}`;if(!n&&h.push("clientId"),!i&&h.push("orgId"),!f&&h.push("tokenProvider"),h.length||(e.auth_key=`${n}|org-${i}`),f&&"function"!=typeof f)throw"Required parameter tokenProvider needs to be a function"}if(h.length>0)throw`Required parameter(s) ${h.join(", ")} are missing`;if(d){let{read:e,write:t}=d;if(!e)throw"Storage read method missing!";if(!t)throw"Storage write method missing!"}}(e.auth,t),e.headers=Object.assign({"x-api-key":e.auth.clientId,"x-request-id":()=>s(),"x-gw-ims-org-id":e.auth.orgId},u(e.headers))}(r,!!t);const o=n.config(r.auth,e);return(e,n={})=>function(e,t,r,n,o){return c(e,t,r,n,!1,o)}(e,n,r,o,t)}},normalizeHeaders:u,generateRequestID:s,AUTH_MODES:a}},265:e=>{async function t(e){e.disableStorage||(e.tokens=await e.read()||{},e.readOnce=!0)}function r(e,t){return void 0!==t.tokens&&t.tokens[e]&&t.tokens[e].expires_at>Date.now()?t.tokens[e]:void 0}e.exports.config=function(e,n){const o=e&&e.disableStorage||!1,i={disableStorage:o,readOnce:o,read:e.storage?e.storage.read:n.read,write:e.storage?e.storage.write:n.write,tokens:{}};return{set:(e,r)=>async function(e,r,n){return r.expires_at=Date.now()+r.expires_in-6e4,await t(n),n.tokens[e]=r,await async function(e){e.disableStorage||await e.write(e.tokens)}(n),r}(e,r,i),get:e=>async function(e,n){let o=!1;n.readOnce||(await t(n),o=!0);let i=r(e,n);return i||o?i:(await t(n),r(e,n))}(e,i)}}},75:(e,t,r)=>{const n=r(149),o="tokens";let i=null,a=!1;e.exports.read=async function(){return a||await async function(){return i||(i=n.init().then((()=>a=!0))),i}(),await n.getItem(o)},e.exports.write=async function(e){return await n.setItem(o,e)}},819:e=>{"use strict";e.exports=require("@adobe/jwt-auth")},682:e=>{"use strict";e.exports=require("debug")},786:e=>{"use strict";e.exports=require("node-fetch")},149:e=>{"use strict";e.exports=require("node-persist")},231:e=>{"use strict";e.exports=require("uuid")}},t={};return function r(n){if(t[n])return t[n].exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}(10)})();