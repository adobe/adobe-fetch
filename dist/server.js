module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){const r=n(1),o=n(3);global.fetch=n(4);const i=n(5);e.exports={config:i.getConfig(r,o),normalizeHeaders:i.normalizeHeaders,generateRequestID:i.generateRequestID,AUTH_MODES:i.AUTH_MODES}},function(e,t,n){const r=n(2),o="tokens";let i=null,a=!1;e.exports.read=async function(){return a||await async function(){return i||(i=r.init().then(()=>a=!0)),i}(),await r.getItem(o)},e.exports.write=async function(e){return await r.setItem(o,e)}},function(e,t){e.exports=require("node-persist")},function(e,t){e.exports=require("@adobe/jwt-auth")},function(e,t){e.exports=require("node-fetch")},function(e,t,n){const r=n(6),o=n(7),i=n(8)("@adobe/fetch"),a="Auth configuration missing.",s={JWT:"jwt",Provided:"provided",Default:"jwt"};function u(){return o().replace(/-/g,"")}function c(e){let t={};if(e)if("function"==typeof e.entries)for(let n of e.entries()){const[e,r]=n;t[e.toLowerCase()]=r}else for(let n in e)t[n.toLowerCase()]=e[n];return t}async function d(e,t,n,r,o,a){const u=await async function(e,t,n,r){const o=e.auth_key;let i=await t.get(o);if(i&&!n)return i;{let n=void 0;n=e.mode===s.JWT?async()=>await r(e):async()=>await e.tokenProvider();try{if(i=await n())return t.set(o,i);throw"Access token empty"}catch(e){throw console.error("Error while getting a new access token.",e),e}}}(n.auth,r,o,a),f=Object.assign({},t);f.headers=function(e,t,n){let r=function(e){let t={};for(let n in e){const r=e[n];t[n]="function"==typeof r?r():r}return t}(n);var o;return t&&t.headers&&(r=Object.assign(r,c(t.headers))),r.authorization=`${o=e.token_type,o[0].toUpperCase()+o.slice(1)} ${e.access_token}`,r}(u,t,n.headers),i(`${f.method||"GET"} ${e} - x-request-id: ${f.headers["x-request-id"]}`);const l=await fetch(e,f);return l.ok||(i(`${f.method||"GET"} ${e} - status ${l.statusText} (${l.status}). x-request-id: ${f.headers["x-request-id"]}`),401!==l.status&&403!==l.status||o)?l:(i(`${t.method||"GET"} ${e} - Will get new token.`),await d(e,t,n,r,!0,a))}function f(e,t){if(!e.auth)throw a;e.auth.mode||(e.auth.mode=t?s.Default:s.Provided),function(e,t){let{mode:n,clientId:r,technicalAccountId:o,orgId:i,clientSecret:a,privateKey:u,metaScopes:c,storage:d,tokenProvider:f}=e;const l=[];if(n===s.JWT){if(!r&&l.push("clientId"),!o&&l.push("technicalAccountId"),!i&&l.push("orgId"),!a&&l.push("clientSecret"),!u&&l.push("privateKey"),(!c||0===c.length)&&l.push("metaScopes"),!t)throw"JWT authentication is not available in current setup.";if(u&&!("string"==typeof u||u instanceof Buffer||ArrayBuffer.isView(u)))throw"Required parameter privateKey is invalid";l.length||(e.auth_key=`${r}|${c.join(",")}`)}else{if(n!==s.Provided)throw`Invalid authentication mode - ${e.mode}`;if(!r&&l.push("clientId"),!i&&l.push("orgId"),!f&&l.push("tokenProvider"),l.length||(e.auth_key=`${r}|org-${i}`),f&&"function"!=typeof f)throw"Required parameter tokenProvider needs to be a function"}if(l.length>0)throw`Required parameter(s) ${l.join(", ")} are missing`;if(d){let{read:e,write:t}=d;if(!e)throw"Storage read method missing!";if(!t)throw"Storage write method missing!"}}(e.auth,t),e.headers=Object.assign({"x-api-key":e.auth.clientId,"x-request-id":()=>u(),"x-gw-ims-org-id":e.auth.orgId},c(e.headers))}e.exports={getConfig:function(e,t){return n=>{f(n,!!t);const o=r.config(n.auth,e);return(e,r={})=>(function(e,t,n,r,o){return d(e,t,n,r,!1,o)})(e,r,n,o,t)}},normalizeHeaders:c,generateRequestID:u,AUTH_MODES:s}},function(e,t){const n=6e4;async function r(e){e.disableStorage||(e.tokens=await e.read()||{},e.readOnce=!0)}function o(e,t){return void 0!==t.tokens&&t.tokens[e]&&t.tokens[e].expires_at>Date.now()?t.tokens[e]:void 0}e.exports.config=function(e,t){const i=e&&e.disableStorage||!1,a={disableStorage:i,readOnce:i,read:e.storage?e.storage.read:t.read,write:e.storage?e.storage.write:t.write,tokens:{}};return{set:(e,t)=>(async function(e,t,o){return t.expires_at=Date.now()+t.expires_in-n,await r(o),o.tokens[e]=t,await async function(e){e.disableStorage||await e.write(e.tokens)}(o),t})(e,t,a),get:e=>(async function(e,t){let n=!1;t.readOnce||(await r(t),n=!0);let i=o(e,t);return i||n?i:(await r(t),o(e,t))})(e,a)}}},function(e,t){e.exports=require("uuid/v4")},function(e,t){e.exports=require("debug")}]);